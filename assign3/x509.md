### 一个关于X.509的小例子和它的工作原理

因为前段时间做的计网实验里面有一部分涉及到了用SSL/TLS加密的ftp传输，这里面也是有x.509的证书有关知识在内，所以就以这个小例子来阐述X.509的工作过程了。

我是用的Serv-U在自己本机上面搭的一个ftp，其中当涉及到加密的部分的时候就会要求生成证书。

#### 生成证书
![生成证书图1](/home/ailin/图片/web_s/Screenshot - 2015年11月05日 - 13时25分07秒.png)

在里面填好相关信息还有密码以后，就会在本地生成证书还有公钥私钥

#### 证书和公钥私钥导出
![生成证书图2](/home/ailin/图片/web_s/Screenshot - 2015年11月05日 - 13时26分27秒.png)

我们可以点开看看

#### CA证书里面的具体信息
![CA证书1](/home/ailin/图片/web_s/Screenshot - 2015年11月05日 - 13时27分50秒.png)
![CA证书2](/home/ailin/图片/web_s/Screenshot - 2015年11月05日 - 13时27分11秒.png)


#### 公钥里面的具体信息
![公钥1](/home/ailin/图片/web_s/Screenshot - 2015年11月05日 - 13时28分06秒.png)
![公钥2](/home/ailin/图片/web_s/Screenshot - 2015年11月05日 - 13时28分25秒.png)

#### 私钥里面的具体信息
（这是要输入了我们开始设置的密码才可以显示出来的）
![私钥1](/home/ailin/图片/web_s/Screenshot - 2015年11月05日 - 13时29分24秒.png)
![私钥2](/home/ailin/图片/web_s/Screenshot - 2015年11月05日 - 14时05分11秒.png)


#### 当客户端来连接服务器
客户端会显示这个消息（因为我们自己生成的这个证书是没有真正去授权的）
![客户端信息](/home/ailin/图片/web_s/Screenshot - 2015年11月05日 - 14时06分38秒.png)
客户端一方选择确定以后就可以正常登陆到ftp上进行操作了。

### 工作流程
这里的公钥私钥应该只会在握手阶段的时候用上。

我们先要弄清楚的一点是：只有公钥才能解密经私钥加密的内容，只有私钥才能解密经公钥加密的内容。

1. 客户端访问服务器的时候，服务器先发送一个带有公钥在内的证书给客户端。
2. 客户端验证服务器发过来的证书，如果发现证书有问题的话，就会提示用户（就是刚刚弹出来的框框）
3. 然后我们刚刚选择了信任该证书，因此客户端就从证书中取出了公钥，然后客户端生成一个随机数k，利用公钥加密，得到的密文发回给服务器。
4. 只有服务器拥有私钥，所以之后服务器才能解密，看到随机数k，这个时候服务器还有客户端都知道了k，在之后的通信中用k进行加密通信





